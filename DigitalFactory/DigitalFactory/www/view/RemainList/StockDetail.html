<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>数字工厂 - 红狮</title>
    <!-- Bootstrap CSS CDN -->
    <!-- Bootstrap core CSS -->
    <link href="../../lib/bootstrap/css/bootstrap-reboot.min.css" rel="stylesheet">
    <link href="../../lib/bootstrap/css/bootstrap-grid.min.css" rel="stylesheet">
    <link href="../../lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="../../css/style.css">
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="../../lib/mCustomScrollbar/jquery.mCustomScrollbar.min.css">
    <!-- Font Awesome JS -->
    <link href="../../lib/font-awesome/css/all.css" rel="stylesheet">
    <!--<script defer src="../../lib/font-awesome/js/all.js"></script>-->

</head>

<body onload="onload()">
    <script src="../../scripts/jquery.js"></script>
    <script type="text/javascript">
        function onload() {
            var login = window.localStorage.a;
            if (login != 1) {
                setTimeout(function () {
                    alert("请先登录");
                    location.href = "../../index.html";
                }, 1000);
            }
            url = window.location.href.split("?")[1];
            //console.log(url);
            $.ajax({
                type: "get",
                contentType: "application/json",
                url: "http://192.168.9.49/api/Receipt/GetRecordByID?ReceiptID=" + url+"",
                //data: data,
                //dataType: 'json',
                error: function (xhr, status, p3, p4) {
                    //console.log(xhr);
                    var err = "Error " + " " + status + " " + p3;
                    if (xhr.responseText && xhr.responseText[0] == "{")
                        err = JSON.parse(xhr.responseText).message;
                    alert("StockDeatail ParseQRValues，" + err + ",请尝试重新登录");
                },
                success: function (result) {
                        //console.log(result);
                        document.getElementById('Company').value = result[0]["Company"];
                        document.getElementById('Partnum').value = result[0]["PartNum"];
                        document.getElementById('Partdescription').value = result[0]["PartDesc"];
                        document.getElementById('BatchNo').value = result[0]["BatchNo"];
                        document.getElementById('Jobnum').value = result[0]["JobNum"];
                        document.getElementById('SupplierNo').value = result[0]["SupplierNo"];
                        document.getElementById('POnum').value = result[0]["PoNum"];
                        document.getElementById('POline').value = result[0]["PoLine"];
                        document.getElementById('receiveQty').value = result[0]["ReceiveQty1"];
                        document.getElementById('POrelnum').value = result[0]["PORelNum"];
                        document.getElementById('HeatNum').value = result[0]["HeatNum"];
                        document.getElementById('plant').value = result[0]["Plant"];
                        document.getElementById('SupplierName').value = result[0]["SupplierName"];
                        document.getElementById('IsAllCheck').value = result[0]["IsAllCheck"];
                        document.getElementById('InspectionQty').value = result[0]["InspectionQty"];
                        document.getElementById('PassedQty').value = result[0]["PassedQty"];
                        document.getElementById('FailedQty').value = result[0]["FailedQty"];
                        document.getElementById('ReceiveQty2').value = result[0]["ReceiveQty2"];
                        document.getElementById('Result').value = result[0]["Result"];
                        document.getElementById('ID').value = result[0]["ID"];
                        document.getElementById('Status').value = result[0]["Status"];
                        document.getElementById('Warehouse').value = result[0]["Warehouse"];
                        document.getElementById('BinNum').value = result[0]["BinNum"];  
                        document.getElementById('ArrivedQty').value = result[0]["ReceiveQty2"];  
                        //原因
                        document.getElementById('ReturnReason').value = result[0]["ReturnReason"];
                        document.getElementById('ReturnReasonRemark').value = result[0]["ReturnReasonRemark"];

                        $("#Warehouse").empty();
                        if (result[0]["Warehouse"] == "")
                        {
                            alert("该物料没有设置主要仓库，请联系相关部门");
                            window.location.reload();
                            return;
                        }         
                        $("#Warehouse").append('<option value=' + result[0]["Warehouse"] + '>' + result[0]["WarehouseName"] + '</option>');
                        //仓库
                        //$.ajax({
                        //    type: "get",
                        //    contentType: "application/json",
                        //    url: "http://192.168.9.49/api/Receipt/GetWarehouse?partnum=" + result[0]["PartNum"] + "",
                        //    //data: "{'value':1}",
                        //    //dataType: 'json',
                        //    error: function (ex) {
                        //        alert("StockDeatail Warehouse，" + ex.error + ",请尝试重新登录");
                        //        return;
                        //    },
                        //    success: function (result1) {
                        //        //console.log(result1);
                        //        $("#Warehouse").empty();
                        //        for (var i = 0; i < result1.length; i++) {
                        //            if (result1[i] != "") {
                        //                $("#Warehouse").append('<option value=' + result1[i]["WarehouseCode"] + '>' + result1[i]["Description"] + '</option>');
                        //            }
                        //        }
                        //    }
                        //});
                }
            });
            
            
            //原因
            $.ajax({
                type: "get",
                contentType: "application/json",
                url: "http://192.168.9.49/api/Receipt/GetReason",
                //data: "{'value':1}",
                dataType: 'json',
                error: function (ex) {
                    alert("StockDeatail reason，" + ex.error + ",请尝试重新登录");
                    return;
                },
                success: function (result) {
                    //console.log(result);
                    $("#reason").empty();
                    for (var i = 0; i < result.length; i++) {
                        if (result[i] != "") {
                            $("#reason").append('<option value=' + result[i]["ID"] + '>' + result[i]["ReasonDesc"] + '</option>');
                        }
                    }
                }
            });
        }
        $(document).ready(function () {
            $("#sidebar").mCustomScrollbar({
                theme: "minimal"
            });

            $('#dismiss, .overlay').on('click', function () {
                $('#sidebar').removeClass('active');
                $('.overlay').removeClass('active');
            });

            $('#sidebarCollapse').on('click', function () {
                $('#sidebar').addClass('active');
                $('.overlay').addClass('active');
                $('.collapse.in').toggleClass('in');
                $('a[aria-expanded=true]').attr('aria-expanded', 'false');
            });
            $("#sidebar1").load("../../header.html");
        });
        //提交
        function Recvive() {
            $(".btn").attr("disabled", true);
            var ID = $("#ID").val();
            var Warehouse = $("#Warehouse").val();
            var BinNum = $("#BinNum").val();
            var ArrivedQty = $("#ArrivedQty").val();
            var data = "{'ID': " + ID + ", 'Warehouse': '" + Warehouse + "','BinNum':'" + BinNum + "','ArrivedQty':'" + ArrivedQty+"'}";
            console.log(data);
            $.ajax({
                type: "post",
                contentType: "application/json",
                url: "http://192.168.9.49/api/Receipt/AcceptCommit",
                data: data,
                //dataType: 'json',
                error: function (xhr, status, p3, p4) {
                    //console.log(xhr);
                    var err = "Error " + " " + status + " " + p3;
                    if (xhr.responseText && xhr.responseText[0] == "{")
                        err = JSON.parse(xhr.responseText).message;
                    alert("提交失败 AcceptCommit，" + err + ",请尝试重新登录");
                },
                success: function (result) {
                    if (result == "处理成功") {
                        alert(result);
                        window.location.href = '/android_asset/www/page-menu.html';
                    }
                    else {
                        alert(result);
                        window.location.reload();
                    }
                }
            });
        }
        //回退
        function back() {
            var Status = $("#Status").val();
            var ID = $("#ID").val();
            var ReasonID = $("#reason").val();
            var ReasonRemark = $("#ReasonRemark").val();
            var data = "{'ID': " + ID + ", 'Status': " + Status + ", 'ReasonID': " + ReasonID + ",'ReasonRemark':'" + ReasonRemark+"'}";
            //console.log(data);
            $.ajax({
                type: "post",
                contentType: "application/json",
                url: "http://192.168.9.49/api/Receipt/ReturnStatus",
                data: data,
                //dataType: 'json',
                error: function (xhr, status, p3, p4) {
                    //console.log(xhr);
                    var err = "Error " + " " + status + " " + p3;
                    if (xhr.responseText && xhr.responseText[0] == "{")
                        err = JSON.parse(xhr.responseText).message;
                    alert("提交失败 Delete，" + err + ",请尝试重新登录");
                },
                success: function (result) {
                    if (result == "处理成功") {
                        alert(result);
                        window.location.href = '/android_asset/www/page-menu.html';
                    }
                    else {
                        alert(result);
                        window.location.reload();
                    }
                }
            });
        }
        function signout() {
            $.ajax({
                type: "get",
                contentType: "application/json",
                url: "http://192.168.9.49/api/Receipt/SignOut",
                //data: "{'value':1}",
                dataType: 'json',
                error: function (ex) {
                    alert("Signout，" + ex.error + ",请关闭程序重新打开");
                    return;
                },
                success: function (result) {
                    window.localStorage.clear();
                    location.href = "../../index.html";
                }
            });
        }
    </script>
    <!-- Sidebar  -->
    <div id="sidebar1">
    </div>
    <!-- Page Content  -->
    <div class="content">
        <header>
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
                <div class="container-fluid">
                    <a class="navbar-brand mr-auto mr-lg-0" href="#">红狮数字工厂</a>

                    <button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                            aria-label="Toggle navigation">
                        <i class="fas fa-align-justify"></i>
                    </button>
                    <button type="button" id="sidebarCollapse" class="btn btn-info">
                        <i class="fas fa-align-left"></i>
                        <!-- <span>Toggle Sidebar</span> -->
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="nav navbar-nav ml-auto">
                            <li class="nav-item active">
                                <a class="nav-link" onclick="signout()">退出</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>
        <main role="main" class="container">
            <div class="row">
                <input type="text" style="display:none" id="ID">
                <input type="text" style="display:none" id="Status">
                <div class="col-md-12 order-md-1">
                    <h4 class="mb-3">操作</h4>
                    <!--<form>-->
                    <fieldset disabled>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="firstName">公司</label>
                                <input type="text" class="form-control" id="Company" placeholder="" value="" required="">
                                <div class="invalid-feedback">
                                    Valid first name is required.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="lastName">供应商编号</label>
                                <input type="text" class="form-control" id="SupplierNo" placeholder="" value="" required="">
                                <div class="invalid-feedback">
                                    Valid last name is required.
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="firstName">供应商名称</label>
                                <input type="text" class="form-control" id="SupplierName" placeholder="" value="" required="">
                                <div class="invalid-feedback">
                                    Valid first name is required.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="lastName">收件日期</label>
                                <input type="text" class="form-control" id="ReceiptDate" placeholder="" value="" required="">
                                <div class="invalid-feedback">
                                    Valid last name is required.
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="firstName">采购单号</label>
                                <input type="text" class="form-control" id="POnum" placeholder="" value="" required="">
                                <div class="invalid-feedback">
                                    Valid first name is required.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="lastName">采购单行号</label>
                                <input type="text" class="form-control" id="POline" placeholder="" value="" required="">
                                <div class="invalid-feedback">
                                    Valid last name is required.
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="firstName">发货行</label>
                                <input type="text" class="form-control" id="POrelnum" placeholder="" value="" required="">
                                <div class="invalid-feedback">
                                    Valid first name is required.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="lastName">物料编码</label>
                                <input type="text" class="form-control" id="Partnum" placeholder="" value="" required="">
                                <div class="invalid-feedback">
                                    Valid last name is required.
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="firstName">物料描述</label>
                                <input type="text" class="form-control" id="Partdescription" placeholder="" value="" required="">
                                <div class="invalid-feedback">
                                    Valid first name is required.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="lastName">批次号</label>
                                <input type="text" class="form-control" id="BatchNo" placeholder="" value="" required="">
                                <div class="invalid-feedback">
                                    Valid last name is required.
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="firstName">炉批号</label>
                                <input type="text" class="form-control" id="HeatNum" placeholder="" value="" required="">
                                <div class="invalid-feedback">
                                    Valid first name is required.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="lastName">工单号</label>
                                <input type="text" class="form-control" id="Jobnum" placeholder="" value="" required="">
                                <div class="invalid-feedback">
                                    Valid last name is required.
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="lastName">接收数量</label>
                                <input type="text" class="form-control" id="receiveQty" placeholder="" value="">
                                <div class="invalid-feedback">
                                    Valid last name is required.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="lastName">备注</label>
                                <input type="text" class="form-control" id="Remark" placeholder="" value="">
                                <div class="invalid-feedback">
                                    Valid last name is required.
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="lastName">是否全检</label>
                                <input type="text" class="form-control" id="IsAllCheck" placeholder="" value="">
                                <div class="invalid-feedback">
                                    Valid last name is required.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="lastName">抽检数量</label>
                                <input type="text" class="form-control" id="InspectionQty" placeholder="" value="">
                                <div class="invalid-feedback">
                                    Valid last name is required.
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="lastName">合格数量</label>
                                <input type="text" class="form-control" id="PassedQty" placeholder="" value="">
                                <div class="invalid-feedback">
                                    Valid last name is required.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="lastName">不合格数量</label>
                                <input type="text" class="form-control" id="FailedQty" placeholder="" value="">
                                <div class="invalid-feedback">
                                    Valid last name is required.
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="lastName">实转数量</label>
                                <input type="text" class="form-control" id="ReceiveQty2" placeholder="" value="">
                                <div class="invalid-feedback">
                                    Valid last name is required.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="lastName">判定结果</label>
                                <input type="text" class="form-control" id="Result" placeholder="" value="">
                                <div class="invalid-feedback">
                                    Valid last name is required.
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="lastName">工厂</label>
                                <input type="text" class="form-control" id="plant" placeholder="" value="">
                                <div class="invalid-feedback">
                                    Valid last name is required.
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="firstName">退回原因</label>
                                <input type="text" class="form-control" id="ReturnReason" placeholder="" value="" required="">
                                <div class="invalid-feedback">
                                    Valid first name is required.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="lastName">退回原因描述</label>
                                <input type="text" class="form-control" id="ReturnReasonRemark" placeholder="" value="" required="">
                                <div class="invalid-feedback">
                                    Valid last name is required.
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <hr class="mb-4">

                    <h4 class="mb-3">仓库</h4>

                    <div class="d-block my-3">
                        <div class="col-md-4 mb-3">
                            <label for="state">请选择仓库</label>
                            <select class="custom-select d-block w-100" id="Warehouse" disabled></select>
                            <div class="invalid-feedback">
                                Please provide a valid state.
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="lastName">库位</label>
                            <input type="text" class="form-control" id="BinNum" placeholder="" value="">
                            <div class="invalid-feedback">
                                Valid last name is required.
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="lastName">入库数量</label>
                            <input type="text" class="form-control" id="ArrivedQty" placeholder="" value="" disabled>
                            <div class="invalid-feedback">
                                Valid last name is required.
                            </div>
                        </div>
                    </div>
                    <hr class="mb-4">
                    <button class="btn btn-primary btn-lg btn-block" type="submit" onclick="Recvive()">收货</button>
                    <button type="button" class="btn btn-warning btn-lg btn-block" data-toggle="modal" data-target="#exampleModal1">回退</button>
                    <!--</form>-->
                </div>
            </div>
            <div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">原因</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="d-block my-3">
                                <div class="col-md-4 mb-3">
                                    <label for="state">请选择原因</label>
                                    <select class="custom-select d-block w-100" id="reason"></select>
                                    <div class="invalid-feedback">
                                        Please provide a valid state.
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="message-text" class="col-form-label">描述:</label>
                                <textarea class="form-control" id="ReasonRemark"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" onclick="back()">提 交</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <footer class="site-footer footer pt-5 text-muted text-center text-small">
            <div class="container">
                <div class="text-center">
                    <p>
                        © Copyrights <strong>HS</strong>. All Rights Reserved
                    </p>
                    <!-- <div class="credits">
                            Created with Dashio template by <a href="https://templatemag.com/">TemplateMag</a>
                        </div> -->
                    <a href="#" class="go-top">
                        <i class="fas fa-angle-up"></i>
                    </a>
                </div>
            </div>
        </footer>

    </div>

    <div class="overlay"></div>
    <!-- jQuery CDN - Slim version (=without AJAX) -->
    <!--<script src="lib/jquery/jquery-3.3.1.slim.min.js"></script>-->
    <!-- Popper.JS -->
    <script src="../../lib/popper.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="../../lib/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery Custom Scroller CDN -->
    <script src="../../lib/mCustomScrollbar/jquery.mCustomScrollbar.concat.min.js"></script>

</body>

</html>