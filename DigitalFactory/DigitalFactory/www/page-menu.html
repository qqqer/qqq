<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>数字工厂 - 红狮</title>
    <!-- Bootstrap CSS CDN -->
    <!-- Bootstrap core CSS -->
    <!--<link href="lib/bootstrap/css/bootstrap-reboot.min.css" rel="stylesheet">
    <link href="lib/bootstrap/css/bootstrap-grid.min.css" rel="stylesheet">
    <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Our Custom CSS -->
    <!--<link rel="stylesheet" href="css/style.css">-->
    <!-- Scrollbar Custom CSS -->
    <!--<link rel="stylesheet" href="lib/mCustomScrollbar/jquery.mCustomScrollbar.min.css">-->
    <!-- Font Awesome JS -->
    <!--<link href="lib/font-awesome/css/all.css" rel="stylesheet">-->
    <!--<script defer src="lib/font-awesome/js/all.js"></script>-->

</head>

<body onload="onload()">
    <script src="scripts/jquery.min.js"></script>
    <script type="text/javascript">
        var pageCount = 5;//一页显示行数
        var pageTotal = 0;//总页数
        var pageCur = 1;//当前页
        var rowTotal = 0;//数据总个数
        var result = "";
        function onload() {
            var login = window.localStorage.a;
            if (login != 1) {
                setTimeout(function () {
                    alert("请先登录");
                    location.href = "./index.html";
                }, 1000);
            }
            $.ajax({
                type: "get",
                contentType: "application/json",
                url: "http://192.168.9.49/api/Receipt/GetRemainsOfUser",
                xhrFields: { withCredentials: 'include' },
                //data: data,
                //dataType: 'json',
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log(XMLHttpRequest);
                    console.log(textStatus);
                    console.log(errorThrown);
                },
                success: function (result1) {
                    //console.log(result1);
                    var _li = "";
                    if (result1 == null) {
                        _li += '<div class="d-flex w-100 justify-content-between"> ';
                        _li += '<h5 class="mb-1">没有未处理信息</h5> ';
                        _li += '</div >';
                        $(".list-group").append(_li);
                        return;
                    }
                    else {
                        rowTotal = result1.length;
                        pageTotal = Math.ceil(result1.length / pageCount);
                        result = result1;
                        for (var j = 1; j <= pageTotal; j++) {
                            $("#Page").append('<option>' + j + '</option>');
                        }
                        if (pageTotal > 1) {
                            dataProcessing(0, pageCount);
                        } else {
                            dataProcessing(0, result1.length);
                        }
                    }

                }
            });
        }
        //扫码
        function BarcodeScan() {
            if (event.keyCode === 13) {
                var QR = $("#txtBarcode").val();
                var reg = new RegExp("(%)", "g");
                QR = QR.replace(reg, '~');
                var _li = "";
                //console.log(QR);
                $.ajax({
                    type: "get",
                    contentType: "application/json",
                    url: "http://192.168.9.49/api/Receipt/GetRecordByQR?values=" + QR + "",
                    //data: "{'SupplierNo':" + supplierno + "}",
                    //dataType: 'json',
                    error: function (xhr, status, p3, p4) {
                        //console.log(xhr);
                        var err = "Error " + " " + status + " " + p3;
                        if (xhr.responseText && xhr.responseText[0] == "{")
                            err = JSON.parse(xhr.responseText).message;
                        alert("扫码失败ParseQRValues，" + err);
                    },
                    success: function (result2) {
                        //console.log(result2);
                        if (result2.error != null) {
                            alert(result2.error);
                            $("#txtBarcode").val("");
                            return;
                        }
                        else {
                            $(".list-group").html("");
                            if (result2.batch[0]["Status"] == 1) {
                                _li += '<a href="view/RemainList/ReceiptDetail.html?' + result2.batch[0]["ID"] + '" class="list-group-item list-group-item-action flex-column align-items-start"> ';
                                if (result2.batch[0]["Colour"] == 0) {
                                    _li += '<div class="d-flex w-100 justify-content-between"> ';
                                }
                                else if (result2.batch[0]["Colour"] == 1) {
                                    _li += '<div class="d-flex w-100 justify-content-between" style="color:red"> ';
                                }
                                else if (result2.batch[0]["Colour"] == 2) {
                                    _li += '<div class="d-flex w-100 justify-content-between" style="color:yellow"> ';
                                }
                                _li += '<h5 class="mb-1">' + result2.batch[0]["PoNum"] + '第' + result2.batch[0]["PoLine"] + '行发货行' + result2.batch[0]["PORelNum"] + '</h5> ';
                                _li += '<small>' + result2.batch[0]["Company"] + '</small> ';
                                _li += '</div >';
                                _li += '<p class="mb-1">物料编码：' + result2.batch[0]["PartNum"] + '</p>';
                                _li += '<p class="mb-1">物料描述：' + result2.batch[0]["PartDesc"] + '</p>';
                                _li += '<small>接收数量：' + result2.batch[0]["ReceiveQty1"] + '</small>';
                                _li += ' </a >';
                            }
                            else if (result2.batch[0]["Status"] == 3) {
                                _li += '<a href="view/RemainList/TransDetail.html?' + result2.batch[0]["ID"] + '" class="list-group-item list-group-item-action flex-column align-items-start"> ';
                                if (result2.batch[0]["Colour"] == 0) {
                                    _li += '<div class="d-flex w-100 justify-content-between"> ';
                                }
                                else if (result2.batch[0]["Colour"] == 1) {
                                    _li += '<div class="d-flex w-100 justify-content-between" style="color:red"> ';
                                }
                                else if (result2.batch[0]["Colour"] == 2) {
                                    _li += '<div class="d-flex w-100 justify-content-between" style="color:yellow"> ';
                                }
                                _li += '<h5 class="mb-1">' + result2.batch[0]["PoNum"] + '第' + result2.batch[0]["PoLine"] + '行发货行' + result2.batch[0]["PORelNum"] + '</h5> ';
                                _li += '<small>' + result2.batch[0]["Company"] + '</small> ';
                                _li += '</div >';
                                _li += '<p class="mb-1">物料编码：' + result2.batch[0]["PartNum"] + '</p>';
                                _li += '<p class="mb-1">物料描述：' + result2.batch[0]["PartDesc"] + '</p>';
                                _li += '<small>接收数量：' + result2.batch[0]["ReceiveQty2"] + '</small>';
                                _li += ' </a >';
                            }
                            else if (result2.batch[0]["Status"] == 4) {
                                _li += '<a href="view/RemainList/StockDetail.html?' + result2.batch[0]["ID"] + '" class="list-group-item list-group-item-action flex-column align-items-start"> ';
                                if (result2.batch[0]["Colour"] == 0) {
                                    _li += '<div class="d-flex w-100 justify-content-between"> ';
                                }
                                else if (result2.batch[0]["Colour"] == 1) {
                                    _li += '<div class="d-flex w-100 justify-content-between" style="color:red"> ';
                                }
                                else if (result2.batch[0]["Colour"] == 2) {
                                    _li += '<div class="d-flex w-100 justify-content-between" style="color:yellow"> ';
                                }
                                _li += '<h5 class="mb-1">' + result2.batch[0]["PoNum"] + '第' + result2.batch[0]["PoLine"] + '行发货行' + result2.batch[0]["PORelNum"] + '</h5> ';
                                _li += '<small>' + result2.batch[0]["Company"] + '</small> ';
                                _li += '</div >';
                                _li += '<p class="mb-1">物料编码：' + result2.batch[0]["PartNum"] + '</p>';
                                _li += '<p class="mb-1">物料描述：' + result2.batch[0]["PartDesc"] + '</p>';
                                _li += '<small>接收数量：' + result2.batch[0]["ReceiveQty2"] + '</small>';
                                _li += ' </a >';
                            }
                            else if (result2.batch[0]["Status"] == 2) {
                                _li += '<div class="d-flex w-100 justify-content-between"> ';
                                _li += '<h5 class="mb-1">请在电脑端查看此条流程</h5> ';
                                _li += '</div >';
                            }
                        }
                        $(".list-group").append(_li);
                    }
                });
            }
        }

        function dataProcessing(startNo, endNo) {
            $(".list-group").html("");
            var _li = "";
            for (var i = 0; i < result.length; i++) {
                if (result[i]["Status"] == 1) {
                    _li += '<a href="view/RemainList/ReceiptDetail.html?' + result[i]["ID"] + '" class="list-group-item list-group-item-action flex-column align-items-start"> ';
                    _li += '<div class="d-flex w-100 justify-content-between"  style="color:red"> ';
                    _li += '<h5 class="mb-1">' + result[i]["PoNum"] + '第' + result[i]["PoLine"] + '行发货行' + result[i]["PORelNum"] + '</h5> ';
                    _li += '<small>' + result[i]["Company"] + '</small> ';
                    _li += '</div >';
                    _li += '<p class="mb-1">物料编码：' + result[i]["PartNum"] + '</p>';
                    _li += '<p class="mb-1">物料描述：' + result[i]["PartDesc"] + '</p>';
                    _li += '<small>接收数量：' + result[i]["ReceiveQty1"] + '</small>';
                    _li += ' </a >';
                }
                else if (result[i]["Status"] == 3) {
                    _li += '<a href="view/RemainList/TransDetail.html?' + result[i]["ID"] + '" class="list-group-item list-group-item-action flex-column align-items-start"> ';
                    if (result[i]["Colour"] == 0) {
                        _li += '<div class="d-flex w-100 justify-content-between"> ';
                    }
                    else if (result[i]["Colour"] == 1) {
                        _li += '<div class="d-flex w-100 justify-content-between" style="color:red"> ';
                    }
                    else if (result[i]["Colour"] == 2) {
                        _li += '<div class="d-flex w-100 justify-content-between" style="color:yellow"> ';
                    }
                    _li += '<h5 class="mb-1">' + result[i]["PoNum"] + '第' + result[i]["PoLine"] + '行发货行' + result[i]["PORelNum"] + '</h5> ';
                    _li += '<small>' + result[i]["Company"] + '</small> ';
                    _li += '</div >';
                    _li += '<p class="mb-1">物料编码：' + result[i]["PartNum"] + '</p>';
                    _li += '<p class="mb-1">物料描述：' + result[i]["PartDesc"] + '</p>';
                    _li += '<small>接收数量：' + result[i]["ReceiveQty2"] + '</small>';
                    _li += ' </a >';
                }
                else if (result[i]["Status"] == 4) {
                    _li += '<a href="view/RemainList/StockDetail.html?' + result[i]["ID"] + '" class="list-group-item list-group-item-action flex-column align-items-start"> ';
                    if (result[i]["Colour"] == 0) {
                        _li += '<div class="d-flex w-100 justify-content-between"> ';
                    }
                    else if (result[i]["Colour"] == 1) {
                        _li += '<div class="d-flex w-100 justify-content-between" style="color:red"> ';
                    }
                    else if (result[i]["Colour"] == 2) {
                        _li += '<div class="d-flex w-100 justify-content-between" style="color:yellow"> ';
                    }
                    _li += '<h5 class="mb-1">' + result[i]["PoNum"] + '第' + result[i]["PoLine"] + '行发货行' + result[i]["PORelNum"] + '</h5> ';
                    _li += '<small>' + result[i]["Company"] + '</small> ';
                    _li += '</div >';
                    _li += '<p class="mb-1">物料编码：' + result[i]["PartNum"] + '</p>';
                    _li += '<p class="mb-1">物料描述：' + result[i]["PartDesc"] + '</p>';
                    _li += '<small>接收数量：' + result[i]["ReceiveQty2"] + '</small>';
                    _li += ' </a >';
                }
            }
            $(".list-group").append(_li);
        }
        $(document).ready(function () {
            $("#sidebar1").load("header.html");
            $("#sidebar").mCustomScrollbar({
                theme: "minimal"
            });

            $('#dismiss, .overlay').on('click', function () {
                $('#sidebar').removeClass('active');
                $('.overlay').removeClass('active');
            });

            $('#sidebarCollapse').on('click', function () {
                $('#sidebar').addClass('active');
                $('.overlay').addClass('active');
                $('.collapse.in').toggleClass('in');
                $('a[aria-expanded=true]').attr('aria-expanded', 'false');
            });
        });
        //分页
        function Previous() {
            if (pageCur > 1) {
                pageCur--;
                var startNo = pageCount * (pageCur - 1);
                var endNo = pageCount * pageCur;
                dataProcessing(startNo, endNo);
                $("#Page").val(pageCur);
            }
        }
        function PageChange(me) {
            pageCur = $(me).val();
            var startNo = pageCount * (pageCur - 1);
            var endNo = 0;
            if (pageCur == pageTotal) {
                endNo = rowTotal;
            }
            else {
                endNo = pageCount * pageCur;
            }
            dataProcessing(startNo, endNo);
        }
        function Next() {
            if (pageCur < pageTotal) {
                pageCur++;
                var startNo = pageCount * (pageCur - 1);
                var endNo = rowTotal;
                dataProcessing(startNo, endNo);
                $("#Page").val(pageCur);
            }
        }
        function signout() {
            $.ajax({
                type: "get",
                contentType: "application/json",
                url: "http://192.168.9.49/api/Receipt/SignOut",
                //data: "{'value':1}",
                dataType: 'json',
                error: function (ex) {
                    alert("Signout，" + ex.error + ",请关闭程序重新打开");
                    return;
                },
                success: function (result) {
                    window.localStorage.clear();
                    location.href = "./index.html";
                }
            });
        }
    </script>
    <div id="sidebar1"></div>
    <!-- Page Content  -->
    <div class="content">
        <header>
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
                <div class="container-fluid">
                    <a class="navbar-brand mr-auto mr-lg-0" href="#">红狮数字工厂</a>

                    <button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                            aria-label="Toggle navigation">
                        <i class="fas fa-align-justify"></i>
                    </button>
                    <button type="button" id="sidebarCollapse" class="btn btn-info">
                        <i class="fas fa-align-left"></i>
                        <!-- <span>Toggle Sidebar</span> -->
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="nav navbar-nav ml-auto">
                            <li class="nav-item active">
                                <a class="nav-link" onclick="signout()">退出</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>
        <main role="main" class="container">

            <!--<form>-->
            <div class="mb-4">
                <label for="txtBarcode">扫码：</label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">@</span>
                    </div>
                    <input type="text" class="form-control" id="txtBarcode" placeholder="扫码" onkeydown="BarcodeScan()">
                    <div class="invalid-feedback" style="width: 100%;">
                        Your username is required.
                    </div>
                </div>
            </div>
            <!--</form>-->

            <div class="mb-4">
                <div class="list-group">

                </div>
            </div>
            <nav aria-label="Page navigation example">
                <ul class="pagination">
                    <li class="page-item">
                        <a class="page-link" href="#" aria-label="Previous" onclick="Previous()">
                            <span aria-hidden="true">&laquo;</span>
                            <span class="sr-only">Previous</span>
                        </a>
                    </li>
                    <li>
                        <select class="custom-select d-block w-100" id="Page" onchange="PageChange(this)"></select>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="#" aria-label="Next" onclick="Next()">
                            <span aria-hidden="true">&raquo;</span>
                            <span class="sr-only">Next</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </main>
        <footer class="site-footer footer pt-5 text-muted text-center text-small">
            <div class="container">
                <div class="text-center">
                    <p>
                        © Copyrights <strong>HS</strong>. All Rights Reserved
                    </p>
                    <a href="#" class="go-top">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>
            </div>
        </footer>

    </div>

    <div class="overlay"></div>
    <!-- jQuery CDN - Slim version (=without AJAX) -->
    <!--<script src="lib/jquery/jquery-3.3.1.slim.min.js"></script>-->
    <!-- Popper.JS -->
    <script src="lib/popper.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="lib/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery Custom Scroller CDN -->
    <script src="lib/mCustomScrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
</body>
</html>